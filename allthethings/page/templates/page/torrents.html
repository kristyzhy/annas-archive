{% extends "layouts/index.html" %}

{% block title %}Torrents{% endblock %}

{% block body %}
  {% if gettext('common.english_only') != 'Text below continues in English.' %}
    <p class="mb-4 font-bold">{{ gettext('common.english_only') }}</p>
  {% endif %}

  <div lang="en">
    <h2 class="mt-4 mb-1 text-3xl font-bold">Torrents</h2>

    <p class="mb-4">
      These torrents represent the vast majority of human knowledge that can be mirrored in bulk. By seeding these torrents, you help preserve humanityâ€™s legacy.
    </p>

    <p class="mb-4">
      These torrents are not meant for downloading individual books. They are meant for long-term preservation. With these torrents you can set up a full mirror of Annaâ€™s Archive, using our <a href="https://annas-software.org/AnnaArchivist/annas-archive">source code</a>. We also have full lists of torrents, as <a href="/dyn/torrents.txt">text</a> or <a href="/dyn/torrents.json">JSON</a>.
    </p>

    <p class="mb-4">
      The list of torrents is split in two parts:<br>
      1. The first part is managed and released by Annaâ€™s Archive. These include books, papers, and magazines from websites such as Z-Library and Internet Archive. It also includes metadata records from websites such as WorldCat and ISBNdb.<br>
      2. The second part is managed and released by others, such as Library Genesis and Sci-Hub. We include these torrents in order to present a unified list of everything you need to mirror Annaâ€™s Archive.<br>
      For more information about the different collections, see the <a href="/datasets">Datasets</a> page.
    </p>

    <p class="mb-4">
      We try to keep minimal duplication or overlap between the torrents in this list. Some torrents get temporarily embargoed (ğŸ”’) upon release, for various reasons (e.g. protecting our scraping methods). An embargo means very slow initial seeding speeds. They get lifted within a year.
    </p>

    <p class="mb-4">
      <strong>IMPORTANT:</strong> If you seed large amounts of our collection (50TB or more), please contact us at <a class="" href="mailto:AnnaArchivist@proton.me">AnnaArchivist@proton.me</a> so we can let you know when we deprecate any large torrents.
    </p>

    <p class="mb-1">
      You can help out enormously by seeding torrents that are low on seeders. If everyone who reads this chips in, we can preserve these collections forever. This is the current breakdown:
    </p>

    <table class="mb-2">
      <tr><td>ğŸ”´ {{ torrents_data.seeder_size_strings[0] }}</td><td class="text-sm text-gray-500 pl-4">{{ gettext('page.home.torrents.legend_less', count=4) }}</td></tr>
      <tr><td>ğŸŸ¡ {{ torrents_data.seeder_size_strings[1] }}</td><td class="text-sm text-gray-500 pl-4">{{ gettext('page.home.torrents.legend_range', count_min=4, count_max=10) }}</td></tr>
      <tr><td>ğŸŸ¢ {{ torrents_data.seeder_size_strings[2] }}</td><td class="text-sm text-gray-500 pl-4">{{ gettext('page.home.torrents.legend_greater', count=10) }}</td></tr>
    </table>

    <div class="js-torrents-chart h-[300px]"></div>
    <div class="mb-1 text-xs text-gray-500">Scraped from <a href="https://opentrackr.org">opentrackr.org</a>.</div>

    <script>
      new Promise((resolve, reject) => document.addEventListener("DOMContentLoaded", () => { resolve () })).then(() => {
        const seedingHistogram = {{ histogram | tojson }};

        const colorsBySeederGroup = ['rgb(240,85,79)', 'rgb(255,218,1)', 'rgb(1,180,1)'];

        Plotly.newPlot(document.querySelector(".js-torrents-chart"), [2,1,0].map((seederGroup) => {
          const seederGroupData = seedingHistogram.filter((item) => item.seeder_group === seederGroup);
          return {
            type: "scatter",
            x: seederGroupData.map((item) => item.day),
            y: seederGroupData.map((item) => item.total_tb),
            marker: {color: colorsBySeederGroup[seederGroup]},
            stackgroup: 'one',
          };
        }), {
          margin: { l: 50, r: 16, b: 50, t: 0, pad: 4 },
          showlegend: false,
              yaxis: { ticksuffix: "TB" },
        }, {staticPlot: true});
      });
    </script>

    {% for toplevel, groups in torrents_data.small_file_dicts_grouped.items() %}
      {% if toplevel == 'managed_by_aa' %}
        <div class="mt-8 group"><span class="text-2xl font-bold" id="managed_by_aa">Managed by Annaâ€™s Archive</span> <a href="#managed_by_aa" class="custom-a invisible group-hover:visible text-gray-400 hover:text-gray-500 text-sm align-[2px]">Â§</a></div>

        <p class="mb-4">
          These torrents are managed and released by Annaâ€™s Archive.
        </p>

        <p class="mb-0">
          Torrents with â€œaacâ€ in the filename use the <a href="https://annas-blog.org/annas-archive-containers.html">Annaâ€™s Archive Containers format</a>. Torrents that are crossed out have been superseded by newer torrents, for example because newer metadata has become available â€” we normally only do this with small metadata torrents. Some torrents that have messages in their filename are â€œadopted torrentsâ€, which is a perk of our top tier <a href="/donate">â€œAmazing Archivistâ€ membership</a>.
        </p>
      {% else %}
        <div class="mt-8 group"><span class="text-2xl font-bold" id="external">External Collections</span> <a href="#external" class="custom-a invisible group-hover:visible text-gray-400 hover:text-gray-500 text-sm align-[2px]">Â§</a></div>

        <p class="mb-4">
          These torrents are managed and released by others. We include these torrents in order to present a unified list of everything you need to mirror Annaâ€™s Archive.
        </p>

        <p class="mb-0">
          This list is very long, so we hide it by default. 
          {% if show_external %}
            <a href="/torrents#external">Hide external torrents.</a>
          {% else %}
            <a href="/torrents?show_external=1#external">Show external torrents.</a>
          {% endif %}
        </p>
      {% endif %}

      <div class="overflow-hidden max-w-full">
        <table>
          {% for group, small_files in groups.items() %}
            <tr><td colspan="100" class="pt-4"><span class="text-xl font-bold" id="{{ group | replace('/', '__') }}">{{ group }}</span> <span class="text-xs text-gray-500">{{ torrents_data.group_size_strings[group] }}</span> <a href="#{{ group | replace('/', '__') }}" class="custom-a invisible [td:hover>&]:visible text-gray-400 hover:text-gray-500 text-sm align-[2px]">Â§</a>

              {% if group == 'libgenli_comics' %}
                <div class="mb-1 text-sm">Comics and magazines from Libgen.li. <a href="/datasets/libgen_li">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/backed-up-the-worlds-largest-comics-shadow-lib.html">blog</a>. <strong>NOTE:</strong> we are looking into splitting these comics/magazines torrents into smaller torrents. This might take a while. When we do this, we will likely provide scripts to migrate the existing torrents to the new torrents, so you donâ€™t have to download from scratch.</div>
              {% elif group == 'zlib' %}
                <div class="mb-1 text-sm">Z-Library books. <a href="/datasets/zlib">dataset</a></div>
              {% elif group == 'isbndb' %}
                <div class="mb-1 text-sm">ISBNdb metadata. <a href="/datasets/isbndb">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/blog-isbndb-dump-how-many-books-are-preserved-forever.html">blog</a></div>
              {% elif group == 'libgenrs_covers' %}
                <div class="mb-1 text-sm">Book covers from Libgen.rs. <a href="/datasets/libgen_rs">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/annas-update-open-source-elasticsearch-covers.html">blog</a></div>
              {% elif group == 'ia' %}
                <div class="mb-1 text-sm">Internet Archive Controlled Digital Lending books and magazines. <a href="/datasets/ia">dataset</a></div>
              {% elif group == 'worldcat' %}
                <div class="mb-1 text-sm">Metadata from OCLC/Worldcat. <a href="/datasets/worldcat">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://annas-blog.org/worldcat-scrape.html">blog</a></div>
              {% elif group == 'libgen_rs_non_fic' %}
                <div class="mb-1 text-sm">Non-fiction book collection from Libgen.rs. <a href="/datasets/libgen_rs">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://libgen.rs/repository_torrent/">original</a></div>
              {% elif group == 'libgen_rs_fic' %}
                <div class="mb-1 text-sm">Fiction book collection from Libgen.rs. <a href="/datasets/libgen_rs">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://libgen.rs/fiction/repository_torrent/">original</a></div>
              {% elif group == 'libgen_li_fic' %}
                <div class="mb-1 text-sm">Fiction book collection from Libgen.li, from the point of divergence from Libgen.rs. <a href="/datasets/libgen_li">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://libgen.li/torrents/fiction/">original</a></div>
              {% elif group == 'scihub' %}
                <div class="mb-1 text-sm">Sci-Hub / Libgen.rs â€œscimagâ€ collection of academic papers. <a href="/datasets/scihub">dataset</a><span class="text-xs text-gray-500"> / </span><a href="https://libgen.rs/scimag/repository_torrent/">original</a></div>
              {% endif %}
            </td></tr>

            {% for small_file in small_files %}
              <tr class="{% if small_file.file_path in torrents_data.obsolete_file_paths %}line-through{% endif %}">
                <td class="pb-1 pr-1 text-xs whitespace-nowrap">{% if small_file.metadata.embargo %}<span title="Torrent under embargo. Download speed extremely limited.">ğŸ”’</span> {% endif %}{% if small_file.aa_currently_seeding %}<span title="Seeded by Annaâ€™s Archive">âœ…</span>{% else %}<span title="Not currently seeded by Annaâ€™s Archive">âŒ</span>{% endif %}</td>
                <td class="pb-1 max-md:break-all"><a href="/dyn/small_file/{{ small_file.file_path }}">{{ small_file.file_path_short }}</a><a class="ml-2 text-sm whitespace-nowrap" href="magnet:?xt=urn:btih:{{ small_file.metadata.btih }}&dn={{ small_file.display_name | urlencode }}&tr=udp://tracker.opentrackr.org:1337/announce">magnet</a></td>
                <td class="text-sm pb-1 pl-2 max-sm:hidden md:whitespace-nowrap" title="Date added">{{ small_file.created }}</td>
                <td class="text-sm pb-1 pl-2"><span class="whitespace-nowrap" title="Data size">{{ small_file.size_string }}</span><span class="whitespace-nowrap max-md:hidden" title="Number of files (there may be more files inside a .tar or .zip file)"> / {{ small_file.metadata.num_files }}</span></td>
                <td class="text-sm pb-1 pl-2 whitespace-nowrap max-md:hidden" title="Data type">{% if small_file.is_metadata %}metadata{% else %}data{% endif %}</td>
                <td class="text-sm pb-1 pl-2 pr-2 lg:whitespace-nowrap">{% if small_file.scrape_metadata.scrape %}<span class="whitespace-nowrap"><span class="text-[10px] leading-none align-[2px]">{% if small_file.scrape_metadata.scrape.seeders < 4 %}<span title="<4 seeders">ğŸ”´</span>{% elif small_file.scrape_metadata.scrape.seeders < 11 %}<span title="4â€“10 seeders">ğŸŸ¡</span>{% else %}<span title=">10 seeders">ğŸŸ¢</span>{% endif %}</span> {{ small_file.scrape_metadata.scrape.seeders }}&nbsp;seed</span><span class="whitespace-nowrap max-md:hidden"> / {{ small_file.scrape_metadata.scrape.leechers }}&nbsp;leech </span><span class="max-md:hidden text-xs text-gray-500 whitespace-nowrap js-scrape-created-{{ small_file.temp_uuid }}" title="{{ small_file.scrape_created | datetimeformat(format='long') }}">â€”</span>{% endif %}</td>
              </tr>
            {% endfor %}

            <script>
              {% for small_file in small_files %}
                document.addEventListener('DOMContentLoaded', () => {
                  document.querySelector('.js-scrape-created-{{ small_file.temp_uuid }}').innerText = window.timeAgo.format(new Date({{ small_file.scrape_created | tojson }}), 'mini');
                });
              {% endfor %}
            </script>
          {% endfor %}
        </table>
      </div>
    {% endfor %}
  </div>
{% endblock %}
