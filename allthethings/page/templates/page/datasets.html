{% extends "layouts/index.html" %}

{% block title %}{{ gettext('page.datasets.title') }}{% endblock %}

{% macro stats_row(label, dict, updated, mirrored_note) -%}
  <td class="p-2 align-top">{{ label }}</td>
  {# TODO: use number formatting to pick "file" or "files" base on the plurality of dict.count #}
  <td class="p-2 align-top">{{ dict.count | numberformat }} {{ gettext('page.datasets.files') }}<br>{{ dict.filesize | filesizeformat }}</td>
  <td class="p-2 align-top whitespace-nowrap">{{ (dict.aa_count/(dict.count+1)*100.0) | decimalformat }}% / {{ (dict.torrent_count/(dict.count+1)*100.0) | decimalformat }}%{% if mirrored_note %}<div class="text-sm text-gray-500 whitespace-normal font-normal">{{ mirrored_note | safe }}</div>{% endif %}</td>
  <td class="p-2 align-top whitespace-nowrap">{{ updated }}</td>
{%- endmacro %}

{% block body %}
  <h2 class="mt-4 mb-1 text-3xl font-bold">{{ gettext('page.datasets.title') }}</h2>

  <div class="mb-4 p-2 overflow-hidden bg-black/5 break-words">
    {{ gettext('page.datasets.intro.text1', a_faq=(' href="/faq#what"' | safe), a_llm=(' href="/llm"' | safe)) }}
  </div>

  <p class="mb-4">
    {{ gettext('page.datasets.intro.text2') }}
  </p>

  <p class="mb-4">
    {{ gettext(
      'page.datasets.intro.text3', 
      a_torrents=(' href="/torrents"' | safe), 
      a_anna_software=(' href="https://software.annas-archive.se/AnnaArchivist/annas-archive/-/blob/main/data-imports/README.md"' | safe),
      a_elasticsearch=(' href="/torrents#aa_derived_mirror_metadata"' | safe),
      a_dbrecord=(' href="/db/aarecord/md5:8336332bf5877e3adbfb60ac70720cd5.json"' | safe)
    ) }}
  </p>

  <h3 class="mt-4 mb-1 text-xl font-bold">{{ gettext('page.datasets.overview.title') }}</h3>

  <p class="mb-4">
    {{ gettext('page.datasets.overview.text1') }}
  </p>

  <table class="mb-4 w-full">
    <tr class="even:bg-[#f2f2f2]">
      <th class="p-2 align-bottom text-left" width="28%">{{ gettext('page.datasets.overview.source.header') }}</th>
      <th class="p-2 align-bottom text-left" width="20%">{{ gettext('page.datasets.overview.size.header') }}</th>
      <th class="p-2 align-bottom text-left" width="20%">{{ gettext('page.datasets.overview.mirrored.header') }}<div class="font-normal text-sm text-gray-500">{{ gettext('page.datasets.overview.mirrored.clarification') }}</div></th>
      <th class="p-2 align-bottom text-left" width="22%">{{ gettext('page.datasets.overview.last_updated.header') }}</th>
    </tr>
    {# TODO: translate the word "files" #}
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/libgen_rs">' | safe) + gettext('common.record_sources_mapping.lgrs') + ('</a><div class="text-sm text-gray-500">' | safe) + gettext('common.record_sources_mapping.lgrs.nonfiction_and_fiction') + '</div>' | safe, stats_data.stats_by_group.lgrs, stats_data.libgenrs_date, '') }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/scihub">' | safe) + gettext('common.record_sources_mapping.scihub') + ('</a><div class="text-sm text-gray-500">' | safe) + gettext('common.record_sources_mapping.scihub.via_lgli_scimag') + '</div>' | safe, stats_data.stats_by_group.journals, ('<div class="text-sm text-gray-500 whitespace-normal">' | safe) + gettext('page.datasets.scihub_frozen_1') + ('<br>' | safe) + gettext('page.datasets.scihub_frozen_2') + '</div>' | safe, '') }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/libgen_li">' | safe) + gettext('common.record_sources_mapping.lgli') + ('</a><div class="text-sm text-gray-500">' | safe) + gettext('common.record_sources.mapping.lgli.excluding_scimag') + '</div>' | safe, stats_data.stats_by_group.lgli, stats_data.libgenli_date, gettext('page.datasets.lgli_fiction_is_behind')) }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/zlib">' | safe) + gettext('common.record_sources_mapping.zlib') + '</a>' | safe, stats_data.stats_by_group.zlib, stats_data.zlib_date, '') }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/ia">' | safe) + gettext('common.record_sources_mapping.iacdl') + '</a>' | safe, stats_data.stats_by_group.ia, stats_data.ia_date, gettext('page.datasets.iacdl.searchable')) }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/duxiu">' | safe) + gettext('common.record_sources_mapping.duxiu') + '</a>' | safe, stats_data.stats_by_group.duxiu, stats_data.duxiu_date, '') }}</tr>
    <tr class="even:bg-[#f2f2f2]">{{ stats_row(('<a class="custom-a underline hover:opacity-60" href="/datasets/upload">' | safe) + gettext('common.record_sources_mapping.uploads') + '</a>' | safe, stats_data.stats_by_group.upload, stats_data.upload_file_date, '') }}</tr>
    <tr class="even:bg-[#f2f2f2] font-bold">{{ stats_row(gettext('page.datasets.overview.total') + ('<div class="text-sm font-normal text-gray-500">' | safe) + gettext('page.datasets.overview.excluding_duplicates') + '</div>' | safe, stats_data.stats_by_group.total, '', '') }}</tr>
  </table>

  <p class="mb-4">
    {{ gettext('page.datasets.overview.text4') }}
  </p>

  <p class="mb-4">
    {{ gettext('page.datasets.overview.text5') }}
  </p>

  <h3 class="mt-4 mb-1 text-xl font-bold">{{ gettext('page.datasets.source_libraries.title') }}</h3>

  <p class="mb-4">
    {{ gettext('page.datasets.source_libraries.text1', a_torrents=(' href="/torrents"' | safe)) }}
  </p>

  <p class="mb-4">
    {{ gettext('page.datasets.source_libraries.text2') }}
  </p>

  <table class="mb-4 w-full">
    <tr class="even:bg-[#f2f2f2]">
      <th class="p-2 align-bottom text-left" width="20%">{{ gettext('page.datasets.sources.source.header') }}</th>
      <th class="p-2 align-bottom text-left" width="40%">{{ gettext('page.datasets.sources.metadata.header') }}</th>
      <th class="p-2 align-bottom text-left" width="40%">{{ gettext('page.datasets.sources.files.header') }}</th>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/libgen_rs">{{ gettext('common.record_sources_mapping.lgrs') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… <a href="https://data.library.bz/dbdumps/">{{ gettext('page.datasets.sources.metadata.libgen_rs') }}</a></div>
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Automated torrents for <a href="https://libgen.rs/repository_torrent/">Non-Fiction</a> and <a href="https://libgen.rs/fiction/repository_torrent/">Fiction</a></div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#libgenrs_covers">book cover torrents</a>.
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/scihub">{{ gettext('common.record_sources_mapping.scihub_scimag') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âŒ Sci-Hub has frozen new files since 2021.</div>
        <div class="my-2 first:mt-0 last:mb-0">âœ… Metadata dumps available <a href="https://sci-hub.ru/database">here</a> and <a href="https://data.library.bz/dbdumps/">here</a>, as well as as part of the <a href="https://libgen.li/dirlist.php?dir=dbdumps">Libgen.li database</a> (which we use).</div>
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Data torrents available <a href="https://sci-hub.ru/database">here</a>, <a href="https://libgen.rs/scimag/repository_torrent/">here</a>, and <a href="https://libgen.li/torrents/scimag/">here</a>.</div>
        <div class="my-2 first:mt-0 last:mb-0">âŒ Some new files are <a href="https://libgen.rs/scimag/recent">being</a> <a href="https://libgen.li/index.php?req=fmode:last&topics%5B%5D=a">added</a> to Libgenâ€™s â€œscimagâ€, but not enough to warrant new torrents.</div>
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/libgen_li">{{ gettext('common.record_sources_mapping.lgli') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Quarterly <a href="https://libgen.li/dirlist.php?dir=dbdumps">HTTP database dumps</a>.</div>
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Non-Fiction torrents are shared with Libgen.rs (and mirrored <a href="https://libgen.li/torrents/libgen/">here</a>).</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ™ƒ Fiction collection has diverged but still has <a href="https://libgen.li/torrents/fiction/">torrents</a>, though not updated since 2022 (we do have direct downloads).</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive and Libgen.li collaboratively manage collections of <a href="/torrents#libgen_li_comics">comic books</a> and <a href="/torrents#libgen_li_magazines">magazines</a>.
        <div class="my-2 first:mt-0 last:mb-0">âŒ No torrents for Russian fiction and standard documents collections.</div>
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/zlib">{{ gettext('common.record_sources_mapping.zlib') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive and Z-Library collaboratively manage a collection of <a href="/torrents#zlib">Z-Library metadata</a>.
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive and Z-Library collaboratively manage a collection of <a href="/torrents#zlib">Z-Library files</a>.
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/ia">{{ gettext('common.record_sources_mapping.iacdl') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Some metadata available through <a href="https://openlibrary.org/developers/dumps">Open Library database dumps</a>, but those donâ€™t cover the entire IA collection.</div>
        <div class="my-2 first:mt-0 last:mb-0">âŒ No easily accessible metadata dumps available for their entire collection.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#ia">IA metadata</a>.
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âŒ Files only available for borrowing on a limited basis, with various access restrictions.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#ia">IA files</a>.
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/duxiu">{{ gettext('common.record_sources_mapping.duxiu') }}</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Various metadata databases scattered around the Chinese internet; though often paid databases.</div>
        <div class="my-2 first:mt-0 last:mb-0">âŒ No easily accessible metadata dumps available for their entire collection.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#duxiu">DuXiu metadata</a>.
      </td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Various file databases scattered around the Chinese internet; though often paid databases.</div>
        <div class="my-2 first:mt-0 last:mb-0">âŒ Most files only accessible using premium BaiduYun accounts; slow downloading speeds.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#duxiu">DuXiu files</a>.
      </td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/duxiu">{{ gettext('common.record_sources_mapping.uploads') }}</a></td>
      <td class="p-2 align-top" colspan="2">
        <div class="my-2 first:mt-0 last:mb-0">Various smaller or one-off sources. We encourage people to upload to other shadow libraries first, but sometimes people have collections that are too big for others to sort through, though not big enough to warrant their own category.</div>
      </td>
    </tr>
  </table>

  <h3 class="mt-4 mb-1 text-xl font-bold">{{ gettext('page.datasets.metadata_only_sources.title') }}</h3>

  <p class="mb-4">
    {{ gettext('page.datasets.metadata_only_sources.text1') }}
  </p>

  <p class="mb-4">
    {{ gettext('page.faq.metadata.inspiration1', a_openlib=(' href="https://en.wikipedia.org/wiki/Open_Library" ' | safe)) }}
    {{ gettext('page.faq.metadata.inspiration2') }}
    {{ gettext('page.faq.metadata.inspiration3', a_blog=(' href="https://annas-archive.se/blog/blog-isbndb-dump-how-many-books-are-preserved-forever.html" ' | safe)) }}
  </p>

  <p class="mb-4">
    {{ gettext('page.datasets.metadata_only_sources.text2') }}
  </p>

  <table class="mb-4 w-full">
    <tr class="even:bg-[#f2f2f2]">
      <th class="p-2 align-bottom text-left">Source</th>
      <th class="p-2 align-bottom text-left">Metadata</th>
      <th class="p-2 align-bottom text-left">Last updated</th>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-middle"><a class="custom-a underline hover:opacity-60" href="/datasets/openlib">Open Library</a></td>
      <td class="p-2 align-middle">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Monthly <a href="https://openlibrary.org/developers/dumps">database dumps</a>.</div>
      </td>
      <td class="p-2 align-middle">{{ stats_data.openlib_date }}</td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/isbndb">ISBNdb</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âŒ Not available directly in bulk, only in semi-bulk behind a paywall.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#isbndb">ISBNdb metadata</a>.
      </td>
      <td class="p-2 align-top">{{ stats_data.isbndb_date }}</td>
    </tr>
    <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-top"><a class="custom-a underline hover:opacity-60" href="/datasets/worldcat">OCLC (WorldCat)</a></td>
      <td class="p-2 align-top">
        <div class="my-2 first:mt-0 last:mb-0">âŒ Not available directly in bulk, protected against scraping.</div>
        <div class="my-2 first:mt-0 last:mb-0">ğŸ‘©â€ğŸ’» Annaâ€™s Archive manages a collection of <a href="/torrents#worldcat">OCLC (WorldCat) metadata</a>.
      </td>
      <td class="p-2 align-top">{{ stats_data.oclc_date }}</td>
    </tr>
    <!-- <tr class="even:bg-[#f2f2f2]">
      <td class="p-2 align-middle"><a class="custom-a underline hover:opacity-60" href="/datasets/isbn_ranges">ISBN country information</a></td>
      <td class="p-2 align-middle">
        <div class="my-2 first:mt-0 last:mb-0">âœ… Available for <a href="https://www.isbn-international.org/range_file_generation">automatic generation</a>.</div>
      </td>
      <td class="p-2 align-middle">{{ stats_data.isbn_country_date }}</td>
    </tr> -->
  </table>

  <h3 class="mt-4 mb-1 text-xl font-bold">{{ gettext('page.datasets.unified_database.title') }}</h3>

  <p class="mb-4">
    {{ gettext(
      'page.datasets.unified_database.text1', 
      a_generated=(' href="https://software.annas-archive.se/AnnaArchivist/annas-archive/-/blob/main/data-imports/README.md"' | safe),
      a_downloaded=(' href="/torrents#aa_derived_mirror_metadata"' | safe),
    ) }}
  </p>

  <p class="mb-4">
    {{ gettext('page.datasets.unified_database.text2', a_json=(' href="/db/aarecord/md5:8336332bf5877e3adbfb60ac70720cd5.json"' | safe)) }}
    
  </p>
{% endblock %}
